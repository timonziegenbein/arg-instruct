from task import Task, Instance
import os
import json
import numpy as np

base_path = os.environ['ARGPACA_MAJA']
superni_path = base_path + '/data/natural-instructions/tasks/'

test_categories = [
    "Textual Entailment",
    "Cause Effect Classification",
    "Coreference Resolution",
    "Dialogue Act Recognition",
    "Answerability Classification",
    "Overlap Extraction",
    "Word Analogy",
    "Keyword Tagging",
    "Question Rewriting",
    "Title Generation",
    "Data to Text",
    "Grammar Error Correction"
]

ADDITIONAL_CLF_TASKNAMES = [ # beside the ones that have 'classif' or 'binary' in the task_name
    'Task1516ImppresNaturallanguageinference',
    'Task391CausalRelationship',
    'Task1391WinograndeEasyAnswerGeneration',
    'Task1393SuperglueCopaTextCompletion',
    'Task893GapFillTheBlankCoreferenceResolution',
    'Task1387AnliR3Entailment',
    'Task020MctacoSpanBasedQuestion',
    'Task520AquamuseAnswerGivenInPassage',
    'Task827CopaCommonsenseReasoning',
    'Task1386AnliR2Entailment',
    'Task050MultircAnswerability',
    'Task133WinowhyReasonPlausibilityDetection',
    'Task970SherliicCausalRelationship',
    'Task892GapReverseCoreferenceResolution',
    'Task828CopaCommonsenseCauseEffect',
    'Task1385AnliR1Entailment',
    'Task1439DoqaCookingIsanswerable',
    'Task290TellmewhyQuestionAnswerability',
    'Task1388CbEntailment',
    'Task392InverseCausalRelationship',
    'Task1442DoqaMoviesIsanswerable',
    'Task623OhsumedYesNoAnswerGeneration',
    'Task1390WscfixedCoreference',
    'Task1155BardAnalogicalReasoningTrashOrTreasure',
]

CLF_TASKNAMES = ['Task1201AtomicClassificationXintent', 'Task931DailydialogClassification', 'Task1212AtomicClassificationHasproperty', 'Task245CheckPresenceInSetIntersection', 'Task1309AmazonreviewSummaryClassification', 'Task495SemevalHeadlineClassification', 'Task1187PolitifactClassification', 'Task1584EvalutionMeronymClassification', 'Task905HateSpeechOffensiveClassification', 'Task1197AtomicClassificationOreact', 'Task351WinomtClassificationGenderIdentifiabilityAnti', 'Task1210AtomicClassificationMadeupof', 'Task1200AtomicClassificationXeffect', 'Task353CasinoClassificationNegotiationElicitPref', 'Task356CasinoClassificationNegotiationSelfNeed', 'Task1333CheckValidityDateDdmmyyyy', 'Task1202AtomicClassificationXneed', 'Task766CraigslistBargainsClassification', 'Task1214AtomicClassificationXwant', 'Task472HaspartClassification', 'Task514ArgumentConsequenceClassification', 'Task869CfqMcd1SqlToExplanation', 'Task112AssetSimpleSentenceIdentification', 'Task587AmazonfoodPolarityCorrectionClassification', 'Task354CasinoClassificationNegotiationNoNeed', 'Task1721CivilCommentsObscenityClassification', 'Task1211AtomicClassificationHassubevent', 'Task430SentevalSubjectCount', 'Task475YelpPolarityClassification', 'Task196Sentiment140AnswerGeneration', 'Task1206AtomicClassificationIsbefore', 'Task391CausalRelationship', 'Task1343AmazonUsReviewsRating', 'Task1607EthosTextClassification', 'Task1533DailyDialogFormalClassification', 'Task109SmsspamcollectionSpamsmsdetection', 'Task1559BlimpBinaryClassification', 'Task1203AtomicClassificationXreact', 'Task214RocstoriesIncorrectEndingClassification', 'Task932DailydialogClassification', 'Task1149ItemCheckEdible', 'Task139Detoxifying-lmsClassificationTopicality', 'Task380BoolqYesNoQuestion', 'Task286OlidOffenseJudgment', 'Task1288GlueMrpcParaphrasing', 'Task902DeceptiveOpinionSpamClassification', 'Task204MnliSameGenreClassification', 'Task346HybridqaClassification', 'Task350WinomtClassificationGenderIdentifiabilityPro', 'Task327JigsawClassificationToxic', 'Task513ArgumentStanceClassification', 'Task936DefeasibleNliSnliClassification', 'Task1380QuarelCorrectOptionGeneration', 'Task190SnliClassification', 'Task092CheckPrimeClassification', 'Task361SpolinYesandPromptResponseClassification', 'Task566CircaClassification', 'Task1313AmazonreviewPolarityClassification', 'Task1535DailyDialogUniquenessClassification', 'Task903DeceptiveOpinionSpamClassification', 'Task399Semeval2018Task1TweetSadnessDetection', 'Task1565TriviaqaClassification', 'Task115HelpAdviceClassification', 'Task673GoogleWellformedQueryClassification', 'Task1192FoodFlavorProfile', 'Task638MultiWozClassification', 'Task1391WinograndeEasyAnswerGeneration', 'Task1215AtomicClassificationCapableof', 'Task1199AtomicClassificationXattr', 'Task1529Scitail1.1Classification', 'Task1354SentCompClassification', 'Task022CosmosqaPassageInappropriateBinary', 'Task1384DealOrNoDialogClassification', 'Task386Semeval2018Task3IronyDetection', 'Task607SbicIntentionalOffenseBinaryClassification', 'Task341WinomtClassificationGenderAnti', 'Task335HateevalClassificationAggresiveEn', 'Task1164Coda19SectionCorrectionClassification', 'Task608SbicSexualOffenseBinaryClassification', 'Task431SentevalObjectCount', 'Task1573SamsumClassification', 'Task457MatresConditionalClassification', 'Task1332CheckLeapYear', 'Task137Detoxifying-lmsClassificationToxicity', 'Task1605EthosTextClassification', 'Task1720CivilCommentsToxicityClassification', 'Task508ScruplesDilemmasMoreEthicalIsidentifiable', 'Task501ScruplesAnecdotesPostTypeVerification', 'Task1283HrngoQualityClassification', 'Task1204AtomicClassificationHinderedby', 'Task1501Dstc3AnswerGeneration', 'Task019MctacoTemporalReasoningCategory', 'Task516SentevalConjointsInversion', 'Task1284HrngoInformativenessClassification', 'Task1393SuperglueCopaTextCompletion', 'Task398Semeval2018Task1TweetJoyDetection', 'Task833PoemSentimentClassification', 'Task422PersentSentenceSentimentVerification', 'Task502ScruplesAnecdotesWhoiswrongVerification', 'Task925CoachedConvPrefClassifier', 'Task149AfsArgumentQualityDeathPenalty', 'Task328JigsawClassificationInsult', 'Task477ClsEnglishDvdClassification', 'Task1623DisflQaDisfluentQuestionClassification', 'Task1534DailyDialogQuestionClassification', 'Task403CreakCommonsenseInference', 'Task333HateevalClassificationHateEn', 'Task1196AtomicClassificationOeffect', 'Task1213AtomicClassificationDesires', 'Task609SbicPotentiallyOffenseBinaryClassification', 'Task515SentevalOddWordOut', 'Task929ProductsReviewsClassification', 'Task355CasinoClassificationNegotiationOtherNeed', 'Task1162Coda19TitleClassification', 'Task679HopeEdiEnglishTextClassification', 'Task020MctacoSpanBasedQuestion', 'Task1311AmazonreviewRatingClassification', 'Task1408DartSimilarityClassification', 'Task070AbductivenliIncorrectClassification', 'Task1186NneHrngoClassification', 'Task211Logic2textClassification', 'Task316Crows-pairsClassificationStereotype', 'Task108ContextualabusedetectionClassification', 'Task738PerspectrumClassification', 'Task1640Aqa1.0AnswerableUnanswerableQuestionClassification', 'Task323JigsawClassificationSexuallyExplicit', 'Task456MatresIntentionClassification', 'Task241TweetqaClassification', 'Task233IircLinkExistsClassification', 'Task520AquamuseAnswerGivenInPassage', 'Task856ConvAi2Classification', 'Task159CheckFrequencyOfWordsInSentencePair', 'Task057MultircClassifyIncorrectAnswer', 'Task296StoryclozeCorrectEndClassification', 'Task147AfsArgumentSimilarityGayMarriage', 'Task494ReviewPolarityAnswerGeneration', 'Task827CopaCommonsenseReasoning', 'Task285ImdbAnswerGeneration', 'Task930DailydialogClassification', 'Task384SocialiqaQuestionClassification', 'Task322JigsawClassificationThreat', 'Task1294WikiQaAnswerVerification', 'Task069AbductivenliClassification', 'Task116Com2senseCommonsenseReasoning', 'Task1705LjspeechClassification', 'Task1189CheckCharInString', 'Task1554ScitailClassification', 'Task1341MsrTextClassification', 'Task359CasinoClassificationNegotiationVouchFair', 'Task145AfsArgumentSimilarityDeathPenalty', 'Task284ImdbClassification', 'Task1624DisflQaQuestionYesnoClassification', 'Task746YelpRestaurantReviewClassification', 'Task1336PeixianEquityEvaluationCorpusGenderClassifier', 'Task362SpolinYesandPromptResponseSubClassification', 'Task1191FoodVegNonveg', 'Task349Squad2.0AnswerableUnanswerableQuestionClassification', 'Task050MultircAnswerability', 'Task1312AmazonreviewPolarityClassification', 'Task133WinowhyReasonPlausibilityDetection', 'Task642EsnliClassification', 'Task358CasinoClassificationNegotiationUvPart', 'Task970SherliicCausalRelationship', 'Task195Sentiment140Classification', 'Task1198AtomicClassificationOwant', 'Task888ReviewsClassification', 'Task848PubmedqaClassification', 'Task340WinomtClassificationGenderPro', 'Task458MatresNegationClassification', 'Task242TweetqaClassification', 'Task1706LjspeechClassification', 'Task274OverrulingLegalClassification', 'Task1216AtomicClassificationCauses', 'Task140Detoxifying-lmsClassificationStyle', 'Task1403CheckValidityDateMmddyyyy', 'Task397Semeval2018Task1TweetAngerDetection', 'Task819PecSentimentClassification', 'Task1488SarcasmdetectionHeadlineClassification', 'Task1645MedicalQuestionPairDatasetTextClassification', 'Task363Sst2PolarityClassification', 'Task220RocstoriesTitleClassification', 'Task761AppReviewClassification', 'Task1381QuarelIncorrectOptionGeneration', 'Task1209AtomicClassificationObjectuse', 'Task935DefeasibleNliAtomicClassification', 'Task052MultircIdentifyBadQuestion', 'Task428SentevalInversion', 'Task226EnglishLanguageAnswerRelevanceClassification', 'Task1587ScifactClassification', 'Task625XlwicTrueOrFalseAnswerGeneration', 'Task966RuletakerFactCheckingBasedOnGivenContext', 'Task844FinancialPhrasebankClassification', 'Task429SentevalTense', 'Task937DefeasibleNliSocialClassification', 'Task459MatresStaticClassification', 'Task148AfsArgumentQualityGayMarriage', 'Task1661SuperGlueClassification', 'Task1344GlueEntailmentClassification', 'Task227ClariqClassification', 'Task1205AtomicClassificationIsafter', 'Task423PersentDocumentSentimentVerification', 'Task575AirDialogueClassification', 'Task828CopaCommonsenseCauseEffect', 'Task478ClsEnglishMusicClassification', 'Task298StoryclozeCorrectEndClassification', 'Task1489SarcasmdetectionTweetClassification', 'Task106ScruplesEthicalJudgment', 'Task1589ScifactClassification', 'Task855ConvAi2Classification', 'Task1517LimitClassfication', 'Task1725CivilCommentsSevertoxicityClassification', 'Task1712PokiClassification', 'Task1207AtomicClassificationAtlocation', 'Task630Dbpedia14Classification', 'Task1548WiqaBinaryClassification', 'Task1583BlessMeronymClassification', 'Task579SocialiqaClassification', 'Task846PubmedqaClassification', 'Task146AfsArgumentSimilarityGunControl', 'Task056MultircClassifyCorrectAnswer', 'Task1439DoqaCookingIsanswerable', 'Task290TellmewhyQuestionAnswerability', 'Task518EmoDifferentDialogueEmotions', 'Task324JigsawClassificationDisagree', 'Task621OhsumedYesNoNumericalAnswerGeneration', 'Task404GrailqaParaphraseValidation', 'Task297StoryclozeIncorrectEndClassification', 'Task289GigawordSummarization', 'Task1604EthosTextClassification', 'Task1722CivilCommentsThreatClassification', 'Task1308AmazonreviewCategoryClassification', 'Task383MatresClassification', 'Task590AmazonfoodSummaryCorrectionClassification', 'Task400PawsParaphraseClassification', 'Task392InverseCausalRelationship', 'Task503ScruplesAnecdotesIsanswerable', 'Task224ScruplesAnecdotesEthicalJudgment', 'Task1606EthosTextClassification', 'Task586AmazonfoodPolarityClassification', 'Task879SchemaGuidedDstc8Classification', 'Task476ClsEnglishBooksClassification', 'Task065TimetravelConsistentSentenceClassification', 'Task493ReviewPolarityClassification', 'Task1392SuperglueMultircAnswerVerification', 'Task213RocstoriesCorrectEndingClassification', 'Task1724CivilCommentsInsultClassification', 'Task337HateevalClassificationIndividualEn', 'Task1442DoqaMoviesIsanswerable', 'Task1089CheckMonotonicArray', 'Task066TimetravelBinaryConsistencyClassification', 'Task199MnliClassification', 'Task1536DailyDialogHappinessClassification', 'Task1346GlueColaGrammaticalCorrectnessClassification', 'Task282ScruplesEventTime', 'Task150AfsArgumentQualityGunControl', 'Task632Dbpedia14Classification', 'Task018MctacoTemporalReasoningPresence', 'Task1285KpaKeypointMatching', 'Task357CasinoClassificationNegotiationSmallTalk', 'Task577CuriosityDialogsClassification', 'Task021MctacoGrammaticalLogical', 'Task232IircLinkNumberClassification', 'Task1495AdverseDrugEventClassification', 'Task1208AtomicClassificationXreason', 'Task623OhsumedYesNoAnswerGeneration', 'Task138Detoxifying-lmsClassificationFluency', 'Task291Semeval2020Task4CommonsenseValidation', 'Task326JigsawClassificationObscene', 'Task1287GlueQqpParaphrasing', 'Task1361MovierationalesClassification', 'Task1390WscfixedCoreference', 'Task310RaceClassification', 'Task1507BooleanTemporalReasoning', 'Task616ColaClassification', 'Task1599SmcalflowClassification', 'Task1560BlimpBinaryClassification', 'Task325JigsawClassificationIdentityAttack', 'Task1723CivilCommentsSexuallyexplicitClassification', 'Task1155BardAnalogicalReasoningTrashOrTreasure', 'Task496SemevalAnswerGeneration', 'Task114IsTheGivenWordLongest', 'Task709MmmluAnswerGenerationHighSchoolPsychology', 'Task1286OpenbookqaQuestionAnswering', 'Task707MmmluAnswerGenerationHighSchoolMicroeconomics', 'Task1421MathqaOther', 'Task209StancedetectionClassification', 'Task712MmmluAnswerGenerationHighSchoolWorldHistory', 'Task695MmmluAnswerGenerationElectricalEngineering', 'Task1516ImppresNaturallanguageinference', 'Task1612SickLabelClassification', 'Task729MmmluAnswerGenerationProfessionalLaw', 'Task347HybridqaIncorrectAnswerGeneration', 'Task717MmmluAnswerGenerationLogicalFallacies', 'Task1541AgnewsClassification', 'Task843FinancialPhrasebankClassification', 'Task231IircLinkClassification', 'Task704MmmluAnswerGenerationHighSchoolGovernmentAndPolitics', 'Task1429EvalutionSemanticRelationClassification', 'Task584UdepsEngFinePosTagging', 'Task200MnliEntailmentClassification', 'Task875EmotionClassification', 'Task683OnlinePrivacyPolicyTextPurposeAnswerGeneration', 'Task302RecordClassification', 'Task710MmmluAnswerGenerationHighSchoolStatistics', 'Task735MmmluAnswerGenerationUsForeignPolicy', 'Task309RaceAnswerGeneration', 'Task734MmmluAnswerGenerationSociology', 'Task709MmmluAnswerGenerationHighSchoolPsychology', 'Task707MmmluAnswerGenerationHighSchoolMicroeconomics', 'Task712MmmluAnswerGenerationHighSchoolWorldHistory', 'Task695MmmluAnswerGenerationElectricalEngineering', 'Task729MmmluAnswerGenerationProfessionalLaw', 'Task717MmmluAnswerGenerationLogicalFallacies', 'Task704MmmluAnswerGenerationHighSchoolGovernmentAndPolitics', 'Task710MmmluAnswerGenerationHighSchoolStatistics', 'Task735MmmluAnswerGenerationUsForeignPolicy', 'Task309RaceAnswerGeneration', 'Task734MmmluAnswerGenerationSociology', 'Task723MmmluAnswerGenerationMoralDisputes', 'Task705MmmluAnswerGenerationHighSchoolMacroeconomics', 'Task694MmmluAnswerGenerationEconometrics', 'Task736MmmluAnswerGenerationVirology', 'Task701MmmluAnswerGenerationHighSchoolComputerScience', 'Task730MmmluAnswerGenerationProfessionalMedicine', 'Task691MmmluAnswerGenerationCollegePhysics', 'Task702MmmluAnswerGenerationHighSchoolEuropeanHistory', 'Task727MmmluAnswerGenerationPrehistory', 'Task667MmmluAnswerGenerationBusinessEthics', 'Task688MmmluAnswerGenerationCollegeComputerScience', 'Task716MmmluAnswerGenerationJurisprudence', 'Task699MmmluAnswerGenerationHighSchoolBiology', 'Task732MmmluAnswerGenerationPublicRelations', 'Task714MmmluAnswerGenerationHumanSexuality', 'Task718MmmluAnswerGenerationMachineLearning', 'Task665MmmluAnswerGenerationAnatomy', 'Task698MmmluAnswerGenerationGlobalFacts', 'Task722MmmluAnswerGenerationRandomTopic', 'Task721MmmluAnswerGenerationMedicalGenetics', 'Task664MmmluAnswerGenerationAbstractAlgebra', 'Task733MmmluAnswerGenerationSecurityStudies', 'Task700MmmluAnswerGenerationHighSchoolChemistry', 'Task666MmmluAnswerGenerationAstronomy', 'Task228ArcAnswerGenerationEasy', 'Task720MmmluAnswerGenerationMarketing', 'Task708MmmluAnswerGenerationHighSchoolPhysics', 'Task696MmmluAnswerGenerationElementaryMathematics', 'Task711MmmluAnswerGenerationHighSchoolUsHistory', 'Task692MmmluAnswerGenerationComputerSecurity', 'Task725MmmluAnswerGenerationNutrition', 'Task685MmmluAnswerGenerationClinicalKnowledge', 'Task686MmmluAnswerGenerationCollegeBiology', 'Task706MmmluAnswerGenerationHighSchoolMathematics', 'Task715MmmluAnswerGenerationInternationalLaw', 'Task719MmmluAnswerGenerationManagement', 'Task724MmmluAnswerGenerationMoralScenarios', 'Task703MmmluAnswerGenerationHighSchoolGeography', 'Task731MmmluAnswerGenerationProfessionalPsychology', 'Task697MmmluAnswerGenerationFormalLogic', 'Task737MmmluAnswerGenerationWorldReligions', 'Task728MmmluAnswerGenerationProfessionalAccounting', 'Task687MmmluAnswerGenerationCollegeChemistry', 'Task689MmmluAnswerGenerationCollegeMathematics', 'Task229ArcAnswerGenerationHard', 'Task693MmmluAnswerGenerationConceptualPhysics', 'Task713MmmluAnswerGenerationHumanAging', 'Task726MmmluAnswerGenerationPhilosophy', 'Task690MmmluAnswerGenerationCollegeMedicine', 'Task1531DailyDialogTypeClassification', 'Task329GapClassification', 'Task1568ProparaClassification', 'Task909DialogrePrevalentSpeakers', 'Task379AgnewsTopicClassification', 'Task1193FoodCourseClassification', 'Task1630OpenpiClassification', 'Task573AirDialogueClassification', 'Task1434HeadQaClassification', 'Task421PersentSentenceSentimentClassification', 'Task279StereosetClassificationStereotype', 'Task084BabiT1SingleSupportingFactIdentifyRelevantFact', 'Task1420MathqaGeneral', 'Task744EurlexClassification', 'Task198MnliDomainClassification', 'Task585PrepositionClassification', 'Task143Odd-man-outClassificationGenerateCategory', 'Task750AquaMultipleChoiceAnswering', 'Task889GoemotionsClassification', 'Task834MathdatasetClassification', 'Task212Logic2textClassification', 'Task1431HeadQaAnswerGeneration', 'Task908DialogreIdentifyFamilialRelationships', 'Task321StereosetClassificationReligion', 'Task681HopeEdiMalayalamTextClassification', 'Task1387AnliR3Entailment', 'Task319StereosetClassificationProfession', 'Task1360NumerSenseMultipleChoiceQaGeneration', 'Task280StereosetClassificationStereotypeType', 'Task375ClassifyTypeOfSentenceInDebate', 'Task517EmoClassifyEmotionOfDialogue', 'Task047MiscellaneousAnsweringScienceQuestions', 'Task880SchemaGuidedDstc8Classification', 'Task611MutualMultiTurnDialogue', 'Task1366HealthfactClassification', 'Task1321CountryContinent', 'Task295Semeval2020Task4CommonsenseReasoning', 'Task201MnliNeutralClassification', 'Task682OnlinePrivacyPolicyTextClassification', 'Task1419MathqaGain', 'Task043EssentialTermsAnsweringIncompleteQuestions', 'Task382HybridqaAnswerGeneration', 'Task462QasperClassification', 'Task1167PennTreebankCoarsePosTagging', 'Task521TriviaQuestionClassification', 'Task1339PeixianEquityEvaluationCorpusTextCompletion', 'Task512TwitterEmotionClassification', 'Task1386AnliR2Entailment', 'Task1385AnliR1Entailment', 'Task640EsnliClassification', 'Task1388CbEntailment', 'Task1338PeixianEquityEvaluationCorpusSentimentClassifier', 'Task1423MathqaGeometry', 'Task118Semeval2019Task10OpenVocabularyMathematicalAnswerGeneration', 'Task1289TrecClassification', 'Task523FindIfNumbersOrAlphabetsAreMoreInList', 'Task202MnliContradictionClassification', 'Task1163Coda19SectionClassification', 'Task893GapFillTheBlankCoreferenceResolution', 'Task641EsnliClassification', 'Task892GapReverseCoreferenceResolution', 'Task1615SickTclassifyBRelationA', 'Task890GcwdClassification', 'Task1394MetaWozTaskClassification']

REG_TASKNAMES = [
    # none
]

def convert_task_name(s):
    parts = s[:-5].split('_')
    return ''.join(part.capitalize() for part in parts)


class SuperNiTask(Task):
    def __init__(self, task_name, task_instruction, dataset_names, data_path, is_clf=False, is_reg=False, **kwargs):
        self.ds_path = base_path + '/data/natural-instructions/tasks/'
        self.data_path = data_path
        super().__init__(task_name, task_instruction, dataset_names, is_clf=is_clf, **kwargs)
        np.random.seed(42)

    def load_data(self):
        with open(os.path.join(self.ds_path, self.data_path)) as f:
            task_data = json.load(f)
        for x in task_data['Instances']:
            self.instances.append(Instance(
                input=x['input'],
                output=x['output'][0],
                split='test' if task_data['Categories'][0] in test_categories else 'train'
            ))
